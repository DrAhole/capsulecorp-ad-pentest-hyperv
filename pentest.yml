---
- hosts: pentest
  become: true
  gather_facts: True
  roles:
    - role: linux_static_ip
  tasks:    
  - name: Updated apt keys
    shell: wget --no-check-certificate https://http.kali.org/kali/pool/main/k/kali-archive-keyring/kali-archive-keyring_2022.1_all.deb -O /tmp/keyring_2022.deb; apt install -f /tmp/keyring_2022.deb

  - name: Remove "binutils" to avoid error dependencies
    ansible.builtin.apt:
      name: binutils
      state: absent

  # - name: Upgrade the OS (apt-get dist-upgrade)
  #   ansible.builtin.apt:
  #     upgrade: dist

  - name: Install "python3-impacket" package
    ansible.builtin.apt:
      name: python3-impacket
      update_cache: yes

  - name: Install "remmina" package
    ansible.builtin.apt:
      name: remmina

  - name: Remove "light-locker" package
    ansible.builtin.apt:
      name: light-locker
      state: absent

  - name: Create user auditor
    ansible.builtin.user:
      name: auditor
      password: ab706ef3eeb56a0e81ea68995414acb9da1a3b1af7df5bce26233b771e674fff16005e632a3d8f5b5dd65d8c22fa7f8b0129ea0c8a16d3d8e78fc7f358bf5ce5
      groups: adm,dialout,cdrom,floppy,sudo,audio,dip,video,plugdev,netdev,wireshark,bluetooth,scanner,kaboxer,docker

  - name: Reboot the machine
    reboot:
      reboot_timeout: 100